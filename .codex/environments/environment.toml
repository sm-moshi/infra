# THIS IS AUTOGENERATED. DO NOT EDIT MANUALLY
version = 1
name = "infra"

[setup]
script = '''
#!/usr/bin/env bash
set -euo pipefail

echo "[codex] Initializing infra environment"

# ---- Tooling checks ----
required_bins=(
  git
  terraform
  ansible
  ansible-playbook
  kubectl
  helm
  kustomize
  yq
  jq
)

for bin in "${required_bins[@]}"; do
  if ! command -v "$bin" >/dev/null 2>&1; then
    echo "[codex] ERROR: Required binary '$bin' not found in PATH"
    exit 1
  fi
done

# ---- Terraform conventions ----
export TF_IN_AUTOMATION=1
export TF_INPUT=0

if [ -f terraform/op.env ]; then
  echo "[codex] Loading terraform/op.env"
  set -a
  # shellcheck disable=SC1091
  source terraform/op.env
  set +a
fi

# ---- Safety rails ----
export KUBECTL_DISABLE_INTERACTIVE=true
export HELM_NO_PLUGINS=1

echo "[codex] Environment ready"
'''

[setup.darwin]
script = '''
#!/usr/bin/env bash
set -euo pipefail

echo "[codex] macOS environment confirmed"

# Homebrew sanity check (do NOT auto-install)
if ! command -v brew >/dev/null 2>&1; then
  echo "[codex] WARNING: Homebrew not found. Tooling must already exist."
fi
'''
