cronSchedule: "0 * * * *"

image:
  registry: ""
  repository: renovate/renovate
  tag: "43.0.10-full"
  pullPolicy: Always

# imagePullSecrets:
#   - harbor-robot-gitea

# hostAliases:
#   - ip: "10.43.175.100"
#     hostnames:
#       - harbor.m0sh1.cc

secretName: renovate-github-token

# Secret of type kubernetes.io/dockerconfigjson containing auth for registries that
# Renovate needs to query (e.g. `dhi.io/*` images).
#
# This does NOT affect image pulls for the Renovate pod itself (use imagePullSecrets for that),
# it is used for Renovate's docker datasource lookups (tags/digests).
dockerConfigSecretName: kubernetes-dhi

# Optional Secret containing a `hostRules` JSON document (key: `hostRules`) for
# authenticating Renovate's docker datasource against registries like `dhi.io`.
# This is complementary to `dockerConfigSecretName` and can help when Renovate's
# docker lookups require explicit host rules.
hostRulesSecretName: renovate-host-rules
hostRulesSecretKey: hostRules

github:
  endpoint: https://api.github.com
  gitAuthor: "Renovate Bot <renovate@m0sh1.cc>"
  repositories: '["sm-moshi/infra", "sm-moshi/helm-charts", "sm-moshi/act"]'

logLevel: debug

podAnnotations:
  m0sh1.cc/restarted-at: "2025-12-27T01:15:00Z"

extraEnv:
  NODE_OPTIONS: "--max-old-space-size=3584"
  RENOVATE_CONCURRENT_LIMIT: "1"
  RENOVATE_WORKER_COUNT: "1"
  RENOVATE_CACHE_DIR: "/tmp/renovate-cache"

podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: "OnRootMismatch"

resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 2
    memory: 2Gi
tolerations: []
affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 90
        preference:
          matchExpressions:
            - key: node-role.kubernetes.io/worker
              operator: Exists
      - weight: 80
        preference:
          matchExpressions:
            - key: topology.kubernetes.io/zone
              operator: In
              values: ["pve-01"]
      - weight: 60
        preference:
          matchExpressions:
            - key: topology.kubernetes.io/zone
              operator: In
              values: ["pve-02"]

persistence:
  cache:
    enabled: true
    storageClass: proxmox-csi-zfs-nvme-fast-retain
    storageSize: 5Gi
    accessModes:
      - ReadWriteOnce
    mountPath: /tmp/renovate-cache
# nodeSelector:
#   node-role.kubernetes.io/worker: "true"
# affinity:
#   nodeAffinity:
#     preferredDuringSchedulingIgnoredDuringExecution:
#       - weight: 50
#         preference:
#           matchExpressions:
#             - key: topology.kubernetes.io/zone
#               operator: In
#               values:
#                 - pve-01
# tolerations:
#   - key: node-role.kubernetes.io/control-plane
#     operator: Exists
#     effect: NoSchedule
