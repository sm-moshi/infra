tenant:
  tenant:
    name: minio

    image:
      repository: quay.io/minio/minio
      tag: RELEASE.2025-09-07T16-13-09Z
      pullPolicy: IfNotPresent

    # Use an existing secret that provides config.env with MINIO_ROOT_USER/MINIO_ROOT_PASSWORD
    configSecret:
      name: minio-root-credentials
      existingSecret: true
      accessKey: ""
      secretKey: ""

    serviceMetadata:
      minioServiceAnnotations:
        traefik.ingress.kubernetes.io/service.serversscheme: https
        traefik.ingress.kubernetes.io/service.serverstransport: minio-tenant-minio-transport@kubernetescrd
      consoleServiceAnnotations:
        traefik.ingress.kubernetes.io/service.serversscheme: https
        traefik.ingress.kubernetes.io/service.serverstransport: minio-tenant-minio-transport@kubernetescrd

    pools:
    - servers: 3
      name: pool-0
      volumesPerServer: 2
      size: 50Gi
      storageClassName: proxmox-csi-zfs-nvme-object-retain
      nodeSelector:
        node-role.kubernetes.io/worker: "true"

    mountPath: /export
    subPath: /data

  ingress:
    api:
      enabled: true
      ingressClassName: "traefik"
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        external-dns.alpha.kubernetes.io/ignore: "true"
      host: s3.m0sh1.cc
      path: /
      pathType: Prefix
      tls:
      - secretName: wildcard-s3-m0sh1-cc
        hosts:
        - s3.m0sh1.cc
    console:
      enabled: true
      ingressClassName: "traefik"
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        external-dns.alpha.kubernetes.io/ignore: "true"
      host: s3-console.m0sh1.cc
      path: /
      pathType: Prefix
      tls:
      - secretName: wildcard-s3-m0sh1-cc
        hosts:
        - s3-console.m0sh1.cc

  pdb:
    enabled: true
    # Leave empty to auto-calc from pool servers (servers - 1)
    minAvailable: ~

# GitOps provisioning for Loki (observability) buckets + MinIO user/policy.
#
# This runs inside the minio-tenant namespace and uses:
# - Root creds from Secret `minio-root-credentials` (key: config.env)
# - Loki S3 creds from Secret `monitoring-loki-s3` (reflected into minio-tenant)
lokiProvisioner:
  enabled: true
  # Run frequently until initial Loki buckets/user/policy are provisioned.
  schedule: "*/2 * * * *"
  image:
    repository: docker.io/minio/mc
    tag: RELEASE.2025-08-13T08-35-41Z
  minioEndpoint: "https://minio.minio-tenant.svc.cluster.local:443"
  rootCredentialsSecret:
    name: minio-root-credentials
    key: config.env
  lokiCredentialsSecret:
    name: monitoring-loki-s3
