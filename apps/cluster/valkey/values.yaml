# apps/cluster/valkey/values.yaml
#
# Shared Valkey service for app workloads. Access is controlled via ACL users.
valkey:
  image:
    # registry: dhi.io
    registry: docker.io
    # repository: valkey
    repository: valkey/valkey
    # tag: 9.0.1-debian13
    tag: 9.0.1-alpine3.23
    pullPolicy: IfNotPresent

  auth:
    enabled: false
    # TODO: Re-enable ACL auth once Harbor uses Redis URLs from secrets (ArgoCD
    # cannot resolve lookup-based credentials at template time).

  replica:
    enabled: false
    replicas: 1
    replicationUser: replication
    minReplicasToWrite: 0
    minReplicasMaxLag: 10
    persistence:
      size: 10Gi
      storageClass: proxmox-csi-zfs-nvme-fast-retain
      accessModes:
        - ReadWriteOnce

  dataStorage:
    enabled: true
    requestedSize: 10Gi
    className: proxmox-csi-zfs-nvme-fast-retain

  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1
      memory: 1Gi

  service:
    type: ClusterIP
    port: 6379

  tolerations: []

  # Use Recreate strategy to avoid multi-attach errors with ReadWriteOnce PVC
  deploymentStrategy: Recreate
  # affinity:
  #   podAntiAffinity:
  #     preferredDuringSchedulingIgnoredDuringExecution:
  #     - weight: 100
  #       podAffinityTerm:
  #         topologyKey: kubernetes.io/hostname
  #         labelSelector:
  #           matchLabels:
  #             app.kubernetes.io/name: valkey
  # topologySpreadConstraints: []
