{{- $pgdata := .Values.proxmoxCsi.storageIds.pgdata -}}
{{- $pgwal := .Values.proxmoxCsi.storageIds.pgwal -}}
{{- $registry := .Values.proxmoxCsi.storageIds.registry -}}
{{- $caches := .Values.proxmoxCsi.storageIds.caches -}}
{{- $minio := .Values.proxmoxCsi.storageIds.minio -}}
{{- $mountOptions := .Values.proxmoxCsi.mountOptions | default (list "noatime") -}}
{{- $ssd := .Values.proxmoxCsi.parameters.ssd | default "true" -}}

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: proxmox-csi-zfs-pgdata-retain
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
    argocd.argoproj.io/sync-options: Replace=true
provisioner: csi.proxmox.sinextra.dev
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  storage: {{ $pgdata | quote }}
  ssd: {{ $ssd | quote }}
mountOptions:
{{- range $mountOptions }}
  - {{ . | quote }}
{{- end }}

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: proxmox-csi-zfs-pgwal-retain
provisioner: csi.proxmox.sinextra.dev
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  storage: {{ $pgwal | quote }}
  ssd: {{ $ssd | quote }}
mountOptions:
{{- range $mountOptions }}
  - {{ . | quote }}
{{- end }}

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: proxmox-csi-zfs-minio-retain
  annotations:
    argocd.argoproj.io/sync-options: Replace=true
provisioner: csi.proxmox.sinextra.dev
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  storage: {{ $minio | quote }}
  ssd: {{ $ssd | quote }}
  cache: directsync
mountOptions:
{{- range $mountOptions }}
  - {{ . | quote }}
{{- end }}

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: proxmox-csi-zfs-registry-retain
provisioner: csi.proxmox.sinextra.dev
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  storage: {{ $registry | quote }}
  ssd: {{ $ssd | quote }}
mountOptions:
{{- range $mountOptions }}
  - {{ . | quote }}
{{- end }}

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: proxmox-csi-zfs-caches-delete
provisioner: csi.proxmox.sinextra.dev
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete
parameters:
  csi.storage.k8s.io/fstype: xfs
  storage: {{ $caches | quote }}
  ssd: {{ $ssd | quote }}
mountOptions:
{{- range $mountOptions }}
  - {{ . | quote }}
{{- end }}
