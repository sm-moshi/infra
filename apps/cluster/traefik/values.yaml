traefik:
  # Traefik Helm Chart Values Configuration
  deployment:
    replicas: 2
    revisionHistoryLimit: 2
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 0

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

  # Schedule on worker nodes only (avoid control plane)
  nodeSelector:
    node-role.kubernetes.io/worker: "true"

  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/control-plane
            operator: DoesNotExist
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          topologyKey: topology.kubernetes.io/zone
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: traefik

  # Topology spread for zone distribution
  topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: traefik
  #           labelSelector:
  #             matchLabels:
  #               app.kubernetes.io/name: traefik

  # topologySpreadConstraints:
  #   - maxSkew: 1
  #     topologyKey: topology.kubernetes.io/zone
  #     whenUnsatisfiable: DoNotSchedule
  #     labelSelector:
  #       matchLabels:
  #         app.kubernetes.io/name: traefik
  #   - maxSkew: 1
  #     topologyKey: kubernetes.io/hostname
  #     whenUnsatisfiable: ScheduleAnyway
  #     labelSelector:
  #       matchLabels:
  #         app.kubernetes.io/name: traefik

  ports:
    web:
      port: 80
      expose:
        default: true
        lan: true
      exposedPort: 80

    websecure:
      port: 443
      expose:
        default: true
        lan: true
      exposedPort: 443

    metrics:
      port: 9100
      expose:
        default: false
      exposedPort: 9100

  ingressClass:
    enabled: true
    isDefaultClass: true

  providers:
    kubernetesCRD:
      enabled: true
    kubernetesIngress:
      enabled: true

  logs:
    general:
      level: INFO
    access:
      enabled: true

  metrics:
    prometheus:
      enabled: false

  service:
    enabled: true
    type: ClusterIP
    additionalServices:
      lan:
        type: LoadBalancer
        annotations:
          metallb.universe.tf/address-pool: services-vlan30
        spec:
          loadBalancerIP: 10.0.30.10

  additionalArguments:
  - --entrypoints.web.address=:80
  - --entrypoints.websecure.address=:443
  # Harbor UI uses encoded slashes (%2F) and percents (%25) in repo paths.
  - --entrypoints.websecure.http.encodedCharacters.allowEncodedSlash=true
  - --entrypoints.websecure.http.encodedCharacters.allowEncodedPercent=true
  # Allow large image pushes (e.g., Harbor) without 60s disconnects.
  - --entrypoints.websecure.transport.respondingTimeouts.readTimeout=15m
  - --entrypoints.websecure.transport.respondingTimeouts.writeTimeout=15m
  - --entrypoints.websecure.transport.respondingTimeouts.idleTimeout=15m
  - --providers.kubernetesingress.ingressendpoint.ip=10.0.30.10
  - --providers.kubernetesingress.ingressendpoint.publishedservice=traefik/traefik-lan

  tlsStore:
    default:
      defaultCertificate:
        secretName: wildcard-m0sh1-cc
