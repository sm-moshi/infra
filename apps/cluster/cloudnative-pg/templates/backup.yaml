{{- $cluster := .Values.cnpg.cluster | default dict -}}
{{- $backup := $cluster.backup | default dict -}}
{{- $manual := $backup.manual | default dict -}}
{{- $objectStoreName := $backup.objectStoreName | default (printf "%s-backups" $cluster.name) -}}
{{- if and $backup.enabled (default false $manual.enabled) }}
apiVersion: postgresql.cnpg.io/v1
kind: Backup
metadata:
  name: {{ $manual.name | default (printf "%s-backup-manual" $cluster.name) }}
  namespace: {{ $cluster.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "16"
spec:
  cluster:
    name: {{ $cluster.name }}
  method: barmanObjectStore
{{- end }}
