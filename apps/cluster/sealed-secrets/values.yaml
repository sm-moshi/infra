# apps/cluster/sealed-secrets/values.yaml
sealed-secrets:
  fullnameOverride: sealed-secrets-controller
  replicaCount: 2
  revisionHistoryLimit: 2
  keyRenewPeriod: "0"
  commandArgs:
    - "--key-prefix=sealed-secrets-key"

  priorityClassName: m0sh1-core

  podDisruptionBudget:
    minAvailable: 1

  # Prefer workers but allow light scheduling on labctrl.
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 80
          preference:
            matchExpressions:
              - key: node-role.kubernetes.io/worker
                operator: Exists
        - weight: 40
          preference:
            matchExpressions:
              - key: node-role.kubernetes.io/control-plane
                operator: DoesNotExist
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            topologyKey: topology.kubernetes.io/zone
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: sealed-secrets

  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: ScheduleAnyway
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: sealed-secrets

  resources:
    requests:
      cpu: 20m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi
