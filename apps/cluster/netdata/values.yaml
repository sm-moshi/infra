netdata:
  image:
    repository: netdata/netdata
    tag: v2.8.5

  restarter:
    enabled: true

  service:
    type: ClusterIP
    port: 19999

  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: traefik
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: "true"
      external-dns.alpha.kubernetes.io/hostname: netdata.m0sh1.cc
    hosts:
    - netdata.m0sh1.cc
    path: /
    pathType: Prefix
    spec:
      ingressClassName: traefik

  parent:
    claiming:
      enabled: true
    envFrom:
    - secretRef:
        name: netdata-claim
    # SECURITY: Netdata requires privileged access to collect system metrics
    # This is a standard requirement for system monitoring tools that need to:
    # - Read /proc and /sys for host metrics
    # - Access host network and process information
    # - Monitor system resources
    # Risk accepted: Monitoring tool in dedicated namespace, regular updates applied
    podSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0

    containerSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      privileged: true
      allowPrivilegeEscalation: true
      readOnlyRootFilesystem: false

    database:
      volumesize: 10Gi
      storageclass: proxmox-csi-zfs-pgdata-retain

    alarms:
      persistence: true
      volumesize: 2Gi
      storageclass: proxmox-csi-zfs-caches-delete

    extraVolumes:
    - name: run-netdata
      emptyDir: {}
    extraVolumeMounts:
    - name: run-netdata
      mountPath: /run/netdata
    - name: run-netdata
      mountPath: /tmp/netdata

    env: {}
    resources:
      requests:
        cpu: 250m
        memory: 512Mi

      limits:
        cpu: 500m
        memory: 1Gi
    nodeSelector: {}
    tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

  child:
    # SECURITY: Child agents also require privileged access for node-level metrics
    # See parent security comment for justification
    podSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0

    containerSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      privileged: true
      allowPrivilegeEscalation: true
      readOnlyRootFilesystem: false

    claiming:
      enabled: true
    envFrom:
    - secretRef:
        name: netdata-claim
    env: {}
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 768Mi
    nodeSelector: {}
    tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

  k8sState:
    podSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      fsGroup: 0
    containerSecurityContext:
      runAsUser: 0
      runAsGroup: 0
      privileged: true
      allowPrivilegeEscalation: true
      readOnlyRootFilesystem: false
    claiming:
      enabled: true
    envFrom:
    - secretRef:
        name: netdata-claim
    persistence:
      enabled: true
      storageclass: local-path
      volumesize: 1Gi
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 768Mi
    nodeSelector: {}
    tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

  rbac:
    create: true

  serviceAccount:
    create: true
    name: netdata
