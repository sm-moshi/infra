# kube-linter configuration for m0sh1.cc infrastructure
# See: https://docs.kubelinter.io/#/configuring-kubelinter

checks:
  # Focus on critical security checks only
  addAllBuiltIn: false
  # Otherwise kube-linter will auto-add its default checks on top of our include list.
  doNotAutoAddDefaults: true

  # Include only essential security checks (excluding those needed by security tools)
  include:
    - "privileged-container"
    - "pdb-max-unavailable"
    - "pdb-min-available"

  # Exclude checks that conflict with repo patterns
  exclude:
    - "dangling-service" # Control plane services won't have pods in static manifests
    - "host-network" # Node exporter and security tools need host access
    - "host-ipc" # Monitoring tools (netdata) need host IPC access
    - "privilege-escalation-container" # Security tools need elevated privileges
    - "privileged-container" # Node management tools (kured) and security tools need privileged access
    - "env-var-secret" # Some charts use SECRET in env var names without exposing secrets
    - "startup-port" # Some charts have complex port configurations
    - "latest-tag" # Some init containers from upstream charts use latest
    - "no-read-only-root-fs" # Some apps need writable root
    - "run-as-non-root" # Some upstream charts don't set this
    - "sorted-keys" # Cosmetic, not security
    - "required-annotation-email" # Not enforced yet
    - "required-label-owner" # Not enforced yet
    - "restart-policy" # Jobs may use Never
    - "unset-cpu-requirements" # Will address incrementally
    - "duplicate-env-var" # Some upstream charts have duplicate env vars in templates
    - "docker-sock" # Security tools (harborguard) need Docker socket access
    - "unset-memory-requirements" # Will address incrementally
    - "no-readiness-probe" # Not all workloads need this
    - "no-liveness-probe" # Not all workloads need this
    - "non-isolated-pod" # NetworkPolicies planned for Phase 4
    - "pdb-unhealthy-pod-eviction-policy" # Advanced PDB feature, not critical
    - "job-ttl-seconds-after-finished" # Will address incrementally
    - "liveness-port" # False positives with containerPort configs
    - "readiness-port" # False positives with containerPort configs
    - "drop-net-raw-capability" # Security tools need network capabilities
    - "host-pid" # Security tools need host access
    - "sensitive-host-mounts" # Security tools need filesystem access
    - "unsafe-sysctls" # cloudflared requires ping_group_range; not actionable in upstream chart

customChecks: []

ignorePaths:
  # Security scanning tools need elevated privileges
  - "kubescape/"
